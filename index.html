<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Darts Scorer MVP</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background: #111;
      color: #fff;
    }
    header {
      padding: 1rem;
      text-align: center;
      background: #1e1e1e;
      font-size: 1.4rem;
    }
    .page {
      display: none;
      padding: 1rem;
    }
    .page.active {
      display: block;
    }
    select, input, button {
      font-size: 1.1rem;
      padding: 0.5rem;
      margin: 0.3rem 0;
      width: 100%;
    }
    button {
      background: #2ecc71;
      border: none;
      color: #000;
      font-weight: bold;
      border-radius: 6px;
    }
    .danger {
      background: #e74c3c;
      color: #fff;
    }
    .scoreboard {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .player {
      width: 40%;
      text-align: center;
    }
    .score {
      font-size: 3rem;
      font-weight: bold;
    }
    .keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }
    .log {
      max-height: 200px;
      overflow-y: auto;
      background: #1e1e1e;
      padding: 0.5rem;
      margin-bottom: 1rem;
    }
    .log div {
      border-bottom: 1px solid #333;
      padding: 0.3rem 0;
    }
  </style>
</head>
<body>

<header>Darts Scorer – MVP</header>

<!-- HOME PAGE -->
<div id="home" class="page active">
  <h2>New Game</h2>

  <label>Player 1</label>
  <select id="player1"></select>

  <label>Player 2</label>
  <select id="player2"></select>

  <label>Game</label>
  <select id="gameType">
    <option value="501">501</option>
    <option value="301">301</option>
  </select>

  <button onclick="startGame()">Start Match</button>

  <h2>Create Player</h2>
  <input id="newPlayerName" placeholder="Player name" />
  <button onclick="addPlayer()">Add Player</button>
</div>

<!-- MATCH PAGE -->
<div id="match" class="page">
  <div class="scoreboard">
    <div class="player" id="playerBox">
      <div id="p1Name"></div>
      <div id="p1Score" class="score"></div>
    </div>
    <div class="player" id="playerBox">
      <div id="p2Name"></div>
      <div id="p2Score" class="score"></div>
    </div>
  </div>

  <div class="log" id="turnLog"></div>

  <div class="keypad" id="keypad">
    <input id="scoreInput" placeholder="Enter score" readonly />
    <button onclick="pressKey(1)">1</button>
    <button onclick="pressKey(2)">2</button>
    <button onclick="pressKey(3)">3</button>
    <button onclick="pressKey(4)">4</button>
    <button onclick="pressKey(5)">5</button>
    <button onclick="pressKey(6)">6</button>
    <button onclick="pressKey(7)">7</button>
    <button onclick="pressKey(8)">8</button>
    <button onclick="pressKey(9)">9</button>
    <button onclick="pressKey(0)">0</button>
    <button onclick="clearInput()">CLR</button>
    <button onclick="submitScore()">ENTER</button>
    <button class="danger" onclick="endMatch()">END</button>
  </div>
</div>

<script>
  const STORAGE_KEY = 'dartsPlayers';
  let players = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

  let game = null;

  function savePlayers() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(players));
  }

  function renderPlayers() {
    const p1 = document.getElementById('player1');
    const p2 = document.getElementById('player2');
    p1.innerHTML = p2.innerHTML = '';
    players.forEach(p => {
      const o1 = document.createElement('option');
      o1.value = p.name;
      o1.textContent = p.name;
      const o2 = o1.cloneNode(true);
      p1.appendChild(o1);
      p2.appendChild(o2);
    });
  }

  function addPlayer() {
    const input = document.getElementById('newPlayerName');
    const name = input.value.trim();
    if (!name) {
      alert('Enter a player name');
      return;
    }

    if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
      alert('Player already exists');
      return;
    }

    players.push({ name, stats: { games: 0, wins: 0, darts: 0 } });
    savePlayers();
    window.onload = function() {
    renderPlayers();
  };

    input.value = '';
  } });
    savePlayers();
    renderPlayers();
    document.getElementById('newPlayerName').value = '';
  }

  function startGame() {
    const p1 = document.getElementById('player1').value;
    const p2 = document.getElementById('player2').value;
    const startScore = parseInt(document.getElementById('gameType').value);
    if (!p1 || !p2 || p1 === p2) return alert('Select two different players');

    game = {
      players: [p1, p2],
      scores: [startScore, startScore],
      turn: 0,
      log: []
    };

    document.getElementById('p1Name').textContent = p1;
    document.getElementById('p2Name').textContent = p2;
    updateScores();
    showPage('match');
  }

  function updateScores() {
    document.getElementById('p1Score').textContent = game.scores[0];
    document.getElementById('p2Score').textContent = game.scores[1];

    const players = document.querySelectorAll('.player');
    players.forEach((p, i) => {
      if (i === game.turn) {
        p.style.opacity = '1';
        p.style.border = '2px solid #2ecc71';
      } else {
        p.style.opacity = '0.4';
        p.style.border = 'none';
      }
    });

    renderLog();
  }() {
    document.getElementById('p1Score').textContent = game.scores[0];
    document.getElementById('p2Score').textContent = game.scores[1];
    renderLog();
  }

  let inputValue = '';

function pressKey(num) {
  inputValue += num;
  document.getElementById('scoreInput').value = inputValue;
}

function clearInput() {
  inputValue = '';
  document.getElementById('scoreInput').value = '';
}

function submitScore() {
  if (!inputValue) return;
  enterScore(parseInt(inputValue));
  clearInput();
}

function enterScore(value)(value) {
    const idx = game.turn;
    const before = game.scores[idx];
    const after = before - value;

    if (after < 0) {
      game.log.push(`${game.players[idx]} bust (${value})`);
    } else if (after === 0) {
      const darts = prompt('Checkout! Which dart? 1 / 2 / 3');
      game.log.push(`${game.players[idx]} wins (checkout dart ${darts})`);
      alert(`${game.players[idx]} wins the leg!`);
      endMatch();
      return;
    } else {
      game.scores[idx] = after;
      game.log.push(`${game.players[idx]} scored ${value}`);
    }

    game.turn = game.turn === 0 ? 1 : 0;
    updateScores();
  }

  function renderLog() {
    const log = document.getElementById('turnLog');
    log.innerHTML = '';
    game.log.slice().reverse().forEach(l => {
      const d = document.createElement('div');
      d.textContent = l;
      log.appendChild(d);
    });
  }

  function undoLast() {
    if (!game.log.length) return;
    game.log.pop();
    alert('Undo is basic in MVP – restart leg if needed');
    renderLog();
  }

  function endMatch() {
    game = null;
    showPage('home');
  }

  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  renderPlayers();
</script>

</body>
</html>
