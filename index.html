<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Darts Scorer MVP</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin:0; background:#111; color:#fff; }
    header { padding:1rem; text-align:center; background:#1e1e1e; font-size:1.4rem; }
    .page { display:none; padding:1rem; }
    .page.active { display:block; }
    select, input, button { font-size:1.1rem; padding:0.6rem; margin:0.4rem 0; width:100%; }
    button { background:#2ecc71; border:none; color:#000; font-weight:700; border-radius:8px; }
    .danger { background:#e74c3c; color:#fff; }
    .scoreboard { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; gap:1rem; }
    .player { width:50%; text-align:center; padding:0.5rem; border-radius:10px; }
    .player.inactive { opacity:0.35; }
    .player.active { border:2px solid #2ecc71; }
    .score { font-size:3rem; font-weight:800; }
    .log { max-height:200px; overflow-y:auto; background:#1e1e1e; padding:0.5rem; margin-bottom:1rem; border-radius:8px; }
    .log div { border-bottom:1px solid #333; padding:0.3rem 0; }
    .keypad { display:grid; grid-template-columns:repeat(3, 1fr); gap:0.5rem; }
    #scoreInput { grid-column:1 / -1; text-align:center; font-size:1.4rem; }
  </style>
</head>
<body>
<header>Darts Scorer â€“ MVP</header>

<!-- HOME -->
<div id="home" class="page active">
  <h2>New Game</h2>
  <label>Player 1</label>
  <select id="player1"></select>
  <label>Player 2</label>
  <select id="player2"></select>
  <label>Game</label>
  <select id="gameType">
    <option value="501">501</option>
    <option value="301">301</option>
  </select>
  <button id="startBtn">Start Match</button>

  <h2>Create Player</h2>
  <input id="newPlayerName" placeholder="Player name" />
  <button id="addPlayerBtn">Add Player</button>
</div>

<!-- MATCH -->
<div id="match" class="page">
  <div class="scoreboard">
    <div id="p1Box" class="player">
      <div id="p1Name"></div>
      <div id="p1Score" class="score"></div>
    </div>
    <div id="p2Box" class="player">
      <div id="p2Name"></div>
      <div id="p2Score" class="score"></div>
    </div>
  </div>

  <div class="log" id="turnLog"></div>

  <div class="keypad">
    <input id="scoreInput" readonly placeholder="Enter score" />
    <button data-num="1">1</button><button data-num="2">2</button><button data-num="3">3</button>
    <button data-num="4">4</button><button data-num="5">5</button><button data-num="6">6</button>
    <button data-num="7">7</button><button data-num="8">8</button><button data-num="9">9</button>
    <button data-num="0">0</button><button id="clrBtn">CLR</button><button id="enterBtn">ENTER</button>
    <button class="danger" id="endBtn">END</button>
  </div>
</div>

<script>
(function(){
  const STORAGE_KEY = 'dartsPlayers';
  let players = [];
  let game = null;
  let inputValue = '';

  function loadPlayers(){
    try {
      players = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    } catch(e){ players = []; }
  }
  function savePlayers(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(players)); }

  function qs(id){ return document.getElementById(id); }

  function renderPlayers(){
    const p1 = qs('player1');
    const p2 = qs('player2');
    p1.innerHTML = ''; p2.innerHTML = '';
    players.forEach(p => {
      const o1 = document.createElement('option'); o1.value = p.name; o1.textContent = p.name;
      const o2 = document.createElement('option'); o2.value = p.name; o2.textContent = p.name;
      p1.appendChild(o1); p2.appendChild(o2);
    });
  }

  function addPlayer(){
    const input = qs('newPlayerName');
    const name = input.value.trim();
    if(!name){ alert('Enter a player name'); return; }
    if(players.some(p => p.name.toLowerCase() === name.toLowerCase())){ alert('Player already exists'); return; }
    players.push({ name, stats:{} });
    savePlayers();
    renderPlayers();
    input.value = '';
  }

  function showPage(id){ document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); qs(id).classList.add('active'); }

  function startGame(){
    const p1 = qs('player1').value;
    const p2 = qs('player2').value;
    const start = parseInt(qs('gameType').value,10);
    if(!p1 || !p2 || p1===p2){ alert('Select two different players'); return; }
    game = { players:[p1,p2], scores:[start,start], turn:0, log:[] };
    qs('p1Name').textContent = p1; qs('p2Name').textContent = p2;
    updateScores(); showPage('match');
  }

  function updateScores(){
    qs('p1Score').textContent = game.scores[0]; qs('p2Score').textContent = game.scores[1];
    qs('p1Box').classList.toggle('active', game.turn===0);
    qs('p1Box').classList.toggle('inactive', game.turn!==0);
    qs('p2Box').classList.toggle('active', game.turn===1);
    qs('p2Box').classList.toggle('inactive', game.turn!==1);
    renderLog();
  }

  function renderLog(){
    const log = qs('turnLog'); log.innerHTML='';
    game.log.slice().reverse().forEach(t=>{ const d=document.createElement('div'); d.textContent=t; log.appendChild(d); });
  }

  function pressNum(n){ inputValue += n; qs('scoreInput').value = inputValue; }
  function clearInput(){ inputValue=''; qs('scoreInput').value=''; }

  function submitScore(){
    if(!inputValue) return;
    const value = parseInt(inputValue,10);
    const idx = game.turn;
    const before = game.scores[idx];
    const after = before - value;

    if(after < 0){
      game.log.push(`${game.players[idx]} bust (${value})`);
    } else if(after === 0){
      const d = prompt('Checkout! Which dart? 1 / 2 / 3');
      game.log.push(`${game.players[idx]} wins (checkout dart ${d})`);
      alert(`${game.players[idx]} wins the leg!`);
      endMatch();
      return;
    } else {
      game.scores[idx] = after;
      game.log.push(`${game.players[idx]} scored ${value}`);
    }

    game.turn = game.turn === 0 ? 1 : 0;
    clearInput();
    updateScores();
  }
    else if(after === 0){ const d = prompt('Checkout! Which dart? 1 / 2 / 3'); game.log.push(`${game.players[idx]} wins (checkout dart ${d})`); alert(`${game.players[idx]} wins the leg!`); endMatch(); return; }
    else { game.scores[idx] = after; game.log.push(`${game.players[idx]} scored ${value}`); }
    game.turn = game.turn===0?1:0; clearInput(); updateScores();
  }

  function endMatch(){ game=null; showPage('home'); }

  document.addEventListener('DOMContentLoaded', function(){
    loadPlayers(); renderPlayers();
    qs('addPlayerBtn').addEventListener('click', addPlayer);
    qs('startBtn').addEventListener('click', startGame);
    qs('clrBtn').addEventListener('click', clearInput);
    qs('enterBtn').addEventListener('click', submitScore);
    qs('endBtn').addEventListener('click', endMatch);
    document.querySelectorAll('[data-num]').forEach(b=>b.addEventListener('click', ()=>pressNum(b.dataset.num)));
  });
})();
</script>
</body>
</html>
